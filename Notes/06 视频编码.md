# 视频编码标准的制定

> [!hint] 考点 2：视频压缩标准及应用

## ITU-T 国际电信联盟 - 电信

### H.261

* 第一个视频压缩标准（1990 年）
* 专为综合业务数字网络（ISDN）视频会议设计的。
* 支持 352X288（CIF）和 176X144（QCIF）的分辨率色度分辨率子采样为 4：2：0
* 由于视频电话需要，在仅需较低的复杂性同时进行实时编码和解码。
* 由于它专注于对延迟敏感的双向视频，<span style="color:#ff0000">H.261 仅允许 I 和 P 帧，不允许 B 帧</span>。（B 帧需要等待后帧解码，存在时延）
* **基于整数像素精度**进行运动估计运算和搜索范围为 +/- 15 像素。
* 将基于 8x8 块的 DCT 应用于残差。然后在所有 AC 系数上进行**固定**的线性量化用**固定**的量化步长线性量化。
* 首先对量化系数进行游程编码，然后可变长度（霍夫曼）编码。
* 将简单的 2D FIR 滤波器应用于块边缘减少块效应。

### H.263

* 用于公共交换电话网络（PSTN）可视电话
* H.263（1996）是在 H.261 之后开发的，专注于更好**更低比特率**的视频质量。
* 通过普通电话调制解调器以 33.6 Kbps 的速度传输视频，是其重要的目标之一。
* 目标分辨率为 SQCIF（128x96）至 CIF（352X288）
* 与 H.261 类似，但运动矢量略有不同。其**允许为½（“半像素”）的倍数**。使用 16x16 宏块中的**四个 8x8 像素块的四个运动矢量**，而不是宏块的单个运动矢量。
* PB 帧：P 帧和 B 帧（这是从当前编码的 P 帧和后一个先前编码的 P 帧预测而来的）编码为一个单元。
* 使用基于内容的算术编码模式代替霍夫曼编码，对于相同的图像质量，比特率略有降低。
* H.263 通常在相同的比特率下实现大约 3 dB 的改善，或者在相同的 SNR（质量）下将比特率减少 50％。

### H.264：Advanced video coding

详看 [[07 🍂H.264即MPEG4 AVC（高级视频编码）]]

## ISO 国际标准化组织

MPEG 成立于 1988 年，旨在开发在数字存储媒体上移动图片（视频）和关联的音频（光盘）的压缩标准。

### MPEG-1

* ISO 制定的第一个视频压缩算法 (1991)
* 可在获得与 VHS 品质相似的视频和音频
* 比特率 1.5Mb/s
* 与典型的视频电话相比，支持电影内容中较重的运动（heavier motion）需要更多的计算资源
* 允许更长的延迟，允许 B 帧
* 使用自适应感知量化。单独的量化比例因子专门应用于每个频点以优化人类的视觉感知。

### MPEG-2

* 是 MPEG-1 的扩展，支持更高的比特率，更高分辨率和**隔行**扫描图片（用于电视）。（先打奇数行再偶数行）
* 是为数字电视开发的比特率较高的应用：DTV，HDTV 和 DVD
* 由许多部分组成，包括视频，音频，系统，兼容性测试。
* 在 30：1 左右的压缩率下表现良好。 MPEG-2 以 4~8 Mbps 达到的质量对于消费者视频应用程序是可接受的。

#### MPEG-2 Profiles and Levels

这些标准旨在解决大量不同的应用程序需要许多不同的工具或功能的问题。典型的应用程序可能仅使用 MPEG 功能的一小部分。 为了实现更有效的实现，MPEG 将功能的子集适当的组合在一起，并定义了一组配置文件和级别。
* 档次（profile）定义了视频语法和功能的子集。
* 在档次（profile）中，级别定义了某些参数的最大范围，例如分辨率，帧速率，比特率和缓冲区大小（下限）。

两个广泛使用的配置文件/级别是：
* Main Level at Main Profile (MP@ML)：用于压缩 DVD 上使用的常规电视（例如 NTSC 或 PAL）和标清数字电视（SD DTV）
* Main Profile at High Level (MP@HL)：用于压缩高清电视（HDTV）（1080p）
![image.png](https://cdn.gallery.uuanqin.top/img/20231109211917.webp)

### MPEG-4

MPEG-4 与 MPEG-1 和 MPEG-2 完全不同，它的主要目标是提供新功能，而不仅仅是提供更好的压缩。将提供增强的功能：
* 支持基于对象或基于内容的表示。这使得可以对视频场景中的不同视频对象进行单独编码，并且允许对视频中的不同对象进行单独访问和操作。请注意，MPEG-4 没有指定如何识别或分割视频中的对象。但是，如果单个对象已知，MPEG-4 提供了一种压缩这些对象的方法。
* 支持对合成或计算机生成的视频对象进行压缩，以及在单个视频中集成自然对象和合成对象。此外，MPEG-4 支持通过差错恢复（例如 Internet 和 3G 无线系统）进行防错通信。因此，MPEG-4 同时支持基于对象和基于帧的视频编码。
* 与场景的交互

![image.png|475](https://cdn.gallery.uuanqin.top/img/20231109213856.webp)
Demuxer 用于解析和解码视频和音频对象。场景描述信息描述了解码对象如何组成和渲染以形成最终场景。

与 MPEG-2 和 MPEG-4 简单档次相比，H.264 / AVC 在压缩效率方面取得了重大突破，通常可实现约 2 倍的压缩。

为了满足从低质量，低分辨率监视摄像机到高清电视广播和 DVD 的各种应用，MPEG-4 第 2 部分定义了大约 21 个档次（profiles）：Simple, Advanced Simple, Main, Core, Advanced Coding Efficiency, Advanced Real Time Simple 等。最常用的档次是 Advanced Simple 和 Simple（都是 Advanced Simple 的子集）。

## 当前视频压缩标准

| 年份 | 标准                | 发布机构                                  | 🔺常用于                                                          |
| ---- | ------------------- | ----------------------------------------- | --------------------------------------------------------------- |
| 1990 | H.261               | ITU-T                                     |ISDN 上的视频会议, 可视电话                               |
| 1993 | MPEG-1 part 2       | ISO, IEC                                  | Video-CD 数字存储媒介（CD-ROM）上的视频                                                       |
| 1995 | H.262/MPEG-2 Part 2 | ISO, IEC, ITU-T                           | DVD Video, Blu-ray, Digital Video Broadcasting, 数字电视                 |
| 1996 | H.263               | ITU-T                                     | 视频会议, PSTN 上的可视电话, Video on Mobile Phones (3GP) |
| 1999 | MPEG-4 Part 2       | ISO, IEC                                  | Video on Internet (DivX, Xvid ...), 基于对象的编码, 合成内容, 集成                           |
| 2003 | H.264/MPEG-4 AVC    | Sony, Panosonic, Samsung, ISO, IEC, ITU-T | Blu-ray,HD DVD Digital Video Broadcasting, 无线, 因特网, 电影, 视频电话, 视频会议                       |

# 标准化的范围

> [!hint] 考点 31：视频编码和解码架构：normative, informative

视频压缩系统由一个编码器，压缩比特流和解码器组成。

标准限定的范围有限，是为了在确保互操作性同时尽可能实现差异化：
* <span style="color:#ff0000">标准指定比特流语法和解码过程</span>
* 标准不限定编码过程或具体解码器的实现。

![image.png](https://cdn.gallery.uuanqin.top/img/20231109202142.webp)
> [!hint] 考点 32：MPEG 编码结构、MPEG 语法

# MPEG 编码结构

MPEG 以单元层次结构编码视频，这些单元称为**序列、图像组 (GOPs)、图像、切片、宏块和 DCT 块**：
* 对 16x16 像素的宏块执行 MC 预测（运动补偿预测）
* 这些宏块组成一个切片
* 一帧中的所有切片均包含一张图片，连续的图片形成一个 GOP。
* 所有 GOP 形成一个序列。

![image.png](https://cdn.gallery.uuanqin.top/img/20231109203121.webp)

## GOP

视频帧被分组为编码单元，称为图像组 (GOPs)。

GOPs 具有重新初始化编码中使用的时间预测的属性。
**GOP 的第一帧总是以帧内模式编码，称为 I 帧**

![image.png|525](https://cdn.gallery.uuanqin.top/img/20231109203351.webp)

用 I 帧通过正向预测或双向预测得到 P 帧或 B 帧。
GOP 长度通常在 9 到 15 帧之间。
**每个 B 帧都取决于过去帧和一个将来帧，这意味着将来帧必须是在当前 B 帧可以被解/编码之前被解/编码。**
**编码后的视频数据以编码顺序放置在数据流中，而不是显示顺序**。

## I P B 帧编码属性

I，P 和 B 帧的编码通常需要不同数据量。
- I 帧需要大量数据，因为它们的编码与其他框架无关。
- <span style="color:#ff0000">P 和 B 帧通常需要的数据少于 I 帧（时间预测）</span>。
- B 帧的编码数据通常少于 P 帧，因为：
	- 同时使用前后参考帧，可以形成更好的预测。
	- 以较低的质量编码 B 帧通常不会带来负面影响，B 帧的编码质量较低不会影响序列中的其他帧。

## 宏块

MPEG 使用 16x16 像素 MC 预测来减少时间视频中固有的冗余。
在 I 帧中，必须以帧内模式对每个宏块进行编码。
在 P 帧中，每个宏块都可以使用前向编码预测或帧内模式。
在 B 帧中，每个宏块都可以前向编码，后向或双向预测或帧内模式。
为每个前向和后向预测指定一个 MV（motion vector）宏块，同时为每个双向指定两个 MV 预测宏块。

## DCT 块

每个宏块（intra or inter）被划分为 8x8 像素块。
为每个块计算 2D-DCT。 DCT 系数被单独量化。
量化系数经过 zigzag 扫描，游程长度进行编码，结果对（游程长度，幅度组成的一对）经过霍夫曼编码并输出至比特流。
还有一些块间和宏块间处理。

## Slices

MPEG 编码要求每个宏块都属于一个切片，所有切片都构成整个图片。
<span style="color:#ff0000">切片是一系列任意数量的连续宏块：</span>
* <span style="color:#ff0000">每个切片至少应包含一个宏块。</span>
* <span style="color:#ff0000">切片不得重叠。</span>
* <span style="color:#ff0000">切片的位置可能因图片而异。</span>
这提供了一种用于预测宏块中某些参数的结构，同时保持一定程度的错误弹性。

在 I 帧中，DCT 系数的 DC 值在一个**片（Slice）内**从块到块被差分编码。（JPEG 是整幅图做差分编码）
在 P 和 B 帧中，运动矢量在片内从宏块到宏块进行差分编码。
如果位流中发生错误，则切片中的剩余数据将丢失。 但是，解码器可以通过搜索下一个切片起始码，重新同步位流并继续解码过程来恢复。

## MPEG Syntax

**序列头**指定图片的高度/宽度，以及样本宽高比，帧速率，比特率和缓冲区大小序列。 如果未使用默认的量化器，则还包括量化矩阵。
**GOP 头**指定时间代码并指示 GOP 是否打开或关闭。
**图像头**指定**时间参考参数**，图片类型（I，P 或 B）以及缓冲区充满度。 如果是使用时域预测，它还描述了运动矢量精度（完整或半像素）和运动矢量范围。
**切片头**指定了切片开始的宏块行，以及 DCT 系数的初始量化器比例因子。
**宏块头**包含一个标志，**指示是内部还是帧间编码**。

对于帧间编码，它包含编码的运动矢量，这个运动矢量会基于相对于先前的运动矢量进行差分编码。
可以在宏块级别上调整量化器比例因子。1bit 用于指定是否调整因子。
序列、GOP、图片、切片的标头以这些代码开头：
* 例如，通过简单地检查编码数据流而无需解析或解码数据，就能找到第二个 GOP 中第二张图片的第二切片编码的数据
* 允许对压缩比特流的随机访问
* 提高容错能力

> [!Example] 习题助记
> MPEG-1 is used in **VCD** ，MPEG-2 is used in **DVD**.
> MP3 is a lossy compression method.
> H.261、H.263 主要用于可视电话
> The bit stream synatax is specified in MPEG video coding standard.
> The encoding process is **NOT** specified in MPEG coding standard.
> MPEG-1 allows B frames.
> P frames require **LESS** data than I frames because of temporal prediction.
> In video coding the position of slices may change from picture to picture.
> In video coding **the Picture header** specifiles the temporal reference parameter