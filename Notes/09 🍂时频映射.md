
音频编码框图：

![image.png](https://cdn.gallery.uuanqin.top/img/20231110202133.webp)

T/F mapping: FFT, PQMF, MDCT

傅里叶变换
- 1822 年，傅里叶指出实时信号可以表示为具有不同频率的信号的总和。
- 傅里叶变换定义如下：
![image.png](https://cdn.gallery.uuanqin.top/img/20231110202311.webp)

- 傅里叶逆变换等于：
![image.png](https://cdn.gallery.uuanqin.top/img/20231110202315.webp)

傅里叶级数
- 对信号在有限时间间隔上的傅里叶变换可以用来在时域中重构原始信号。
- 实际上，我们不需要完整的傅里叶变换数据来完全在时域中重构信号。
- 我们只需要在离散频率点 f=k/T（其中 k 是整数）处的 X(f) 值。
- 我们通过将窗口信号替换为在时间间隔从 -T/2 到 T/2 内相等的信号，但在该间隔之外周期性地重复，来进行数据压缩。
对于生成的周期信号，我们可以定义傅里叶级数：
![image.png](https://cdn.gallery.uuanqin.top/img/20231110202643.webp)

- $X[k]$ 只是时间限定信号在离散频率集合 $f=k/T$ 处的傅里叶变换。
- 我们可以使用以下公式重构 x(t)：![image.png](https://cdn.gallery.uuanqin.top/img/20231110202703.webp)
采样定理
- 假设一个信号在频率范围从 -Fmax 到 Fmax 内具有频率内容。
- 如果我们选择某个频率间隔 Fs≥2Fmax，并周期性地延续信号的频谱范围超出从 -Fs/2 到 Fs/2 的范围。
- 从傅里叶级数的定义可以想象，这个频率周期函数只有离散时间分量 $x[n]$（如果我们定义 $T=1/F_s$，则有 $x[n]=x(nT)$）。

在时域中对信号进行窗函数处理
- 假设我们开始处理一个带限信号，并以采样频率 Fs≥2Fmax 对信号进行采样。
- 假设我们想要使用有限的样本块进行计算，以便在等待信号完成之前开始进行计算。
- 实现这个目标的一种方法是将原始的非有限信号 x(t) 与矩形窗函数相乘。

矩形窗函数
- 矩形窗函数 WR(t) 在 t=0 到 t=T 之间等于 1，在其他地方等于零。
- 我们可能想知道这个时限信号是否仍然足够带限。
- 时限信号的傅里叶变换等于原始信号的傅里叶变换与 WR(t) 的傅里叶变换 WR(f) 的卷积。
- WR(f) 的傅里叶变换随着频率的增加下降得非常缓慢，这意味着时限信号的傅里叶变换很可能不再足够带限。
- 如果我们使用这个窗函数，会发生混叠现象。

正弦窗函数
- 矩形窗函数的问题在于窗口边缘处的截断非常尖锐。
- 尖锐的变化会导致高频成分。
- 在时域中，更好的窗函数选择是在边缘处缓慢衰减，以避免尖锐的不连续性。
- 正弦窗函数为 ws(t) = sin(πt/T)，0≤t≤T。当应用于离散时间信号的 N 个样本时，窗函数变为 ws[n] = sin(π(n+1/2)/N)，其中 n=0，...，N-1。
- 从频谱中可以看出，主瓣比矩形窗函数更宽，但频率幅度下降得更快。

汉宁窗函数
- 汉宁窗函数在边缘处没有正弦窗函数那样的突变。
- 汉宁窗函数为 wH(t) = 1/2(1-cos(2πt/T))，0≤t≤T。
- 当应用于离散时间信号的 N 个样本时，窗函数变为 wH[n] = 1/2(1-cos[2π(n+1/2)/N])，其中 n=0，...，N-1。
- 从频谱中可以看出，汉宁窗函数的衰减速度更快（有助于避免混叠），但其主瓣的宽度更大（对于准确的频率识别不利）。
- 在窗函数设计中，我们面临权衡：低旁瓣能量（与杂散频率成分相关）和主瓣的宽度（窗函数的频率分辨率）。

> [!hint] 考点 17：FFT 和复杂度

快速傅里叶变换（FFT）
- 直接计算 DFT 需要 $N^2$ 次复数乘法和加法运算。
- 令人惊讶的是，FFT 允许我们在大约 $N×log_2N$ 次复数乘法/加法运算中完成完全相同的计算。
- 以 N=1024 为例，FFT 只需要 DFT 所需计算时间的 1%。
- 这个算法最早由高斯在 1880 年提出，后来由库利和图基在 1965 年重新发现。

> [!hint] 考点 15：傅里叶变换、傅里叶级数、离散时间傅里叶变换、离散傅里叶变换

|                    | 时域                   | 频域               |
| ------------------ | ---------------------- | ------------------ |
| 傅里叶变换         | 连续、无限             | 连续、无限         |
| 傅里叶级数         | 有限信号周期延拓，连续 | 离散               |
| 离散时间傅里叶变换 | 离散                   | 有限频谱的周期延拓 |
| <span style="color:#ff0000">离散傅里叶变换</span>     | 离散，有限             | 离散，有限                   |

> [!hint] 考点 16：Windowing

|        | 去混叠 | 频率选择性 |
| ------ | ------ | ---------- |
| 矩形窗 | 最差   | <span style="color:#ff0000">最好</span>       |
| 正弦窗 | 中等   | 中等       |
| 汉宁窗 | 最好   | 最差           |

> [!hint] 考点 18：MDCT：重叠相加技术、长窗、短窗

MDCT

重叠相加技术
- PQMF 通常被视为时频银行（Time Frequency banks）。相应的编码称为子带编码。
- 如果在音频编码过程中，将时域的数据样本映射到频域的数据样本，例如使用 FFT，这种音频编码方法称为变换编码。
- 我们已经知道，在进行 DFT 之前，音频信号会进行窗函数处理以避免混叠效应，在解码器中，我们需要知道如何恢复原始信号。
- 除了应用逆离散傅里叶变换之外，我们还需要将窗函数的影响从数据中去除。
- 第一种方法是将逆 DFT 的输出除以窗函数系数。
- 问题在于量化/反量化会在信号中引入小的误差。
- 这些误差可能是听不到的，但是将逆 DFT 的输出除以窗函数可能会放大数据块边缘附近的误差，因为窗函数在该区域被设计为平滑地趋近于零。

![image.png|450](https://cdn.gallery.uuanqin.top/img/20231110204338.webp)

在编码器中，块输入信号是重叠的。在解码器中，我们重叠并相加输出信号。
窗函数的设计使得在没有量化的情况下可以恢复原始信号。

![image.png](https://cdn.gallery.uuanqin.top/img/20231110204716.webp)
重叠量 $N-M ≤ N/2$

在编码器中，每个连续的数据块从前一个数据块的起始位置后的 M 个样本开始，并包括 M 个新的数据样本。
在解码器中：
- 我们将逆变换和窗函数处理后的数据的前 M 个样本传输到输出缓冲区。
- 将剩余的 N-M 个样本存储到存储缓冲区中。
- 我们将前一个数据块存储缓冲区中的 N-M 个样本与当前数据块输出缓冲区的前 N-M 个样本相加。
- 然后，我们将输出缓冲区的 M 个样本发送到解码器的输出流中。

我们选择在解码器中进行窗函数处理的原因是：
- 使逆变换块边缘附近的量化噪声较小；
- 分析和合成阶段可以对称地进行。

对于分析和合成窗函数 $wa[n]$ 和 $ws[n]$，有以下要求：
- 在没有重叠的任何块区域中，![image.png](https://cdn.gallery.uuanqin.top/img/20231110204931.webp)
- 在重叠区域中，![image.png](https://cdn.gallery.uuanqin.top/img/20231110204934.webp)
该条件将一个块的窗函数的右侧与下一个块的窗函数的左侧相关联。i 是块的索引。

窗的选择：

如果分析和合成窗函数是相同的，我们有：
![image.png](https://cdn.gallery.uuanqin.top/img/20231110205027.webp)

一个满足这个条件的简单窗函数是：
![image.png](https://cdn.gallery.uuanqin.top/img/20231110205032.webp)
正弦窗口可能无法为特定应用提供频率分辨率与泄漏之间的权衡。实际上，我们可以通过一种归一化过程来修改任何窗口函数，以满足重叠相加条件。

![image.png](https://cdn.gallery.uuanqin.top/img/20231110205646.webp)

如果 w'(p) 具有控制其形状的参数，我们可以调整这些参数以调节归一化窗口以适应特定应用。归一化过程可以使用 Kaiser-Bessel 窗口作为核窗口，并在相邻块之间具有 50% 的重叠来进行，从而创建所谓的“Kaiser-Bessel 衍生”窗口。

音频编码中的窗口考虑因素：
- 在音频编码中，我们希望：
  - 最大化频率分离。
  - 最小化音频阻塞效应的影响。
- 所选的窗口长度和形状与这两个属性有关。
- 给定输入数据到滤波器组的块大小，窗口形状的选择决定了滤波器组的频谱分离程度：
  - 正弦窗口比α=4 的 KBD 窗口具有更好的近端选择性（主瓣更窄）。
  - 正弦窗口的侧瓣能量的抑制程度较差。
根据输入音频信号的特性，正弦窗口或α=4 的 KBD 窗口可能为信号表示提供更好的频率分辨率：
- 对于高度音调的信号，近端选择性比频率表示中的最终抑制更重要。
- 如果信号的频率分量之间存在较大的分离，更高的最终抑制可以更好地利用信号分量的掩蔽效应。

改进离散余弦变换（MDCT）：
- 为了减少窗口化引起的阻塞效应，我们希望窗口边缘的过渡到零尽可能平缓。
- 这意味着当我们设置大的重叠区域时，阻塞效应最小。
- 然而，我们需要对每 M 个新的时间样本输入编码器的样本进行 N 个样本的变换数据的编码、传输/存储。
- 在从冗余和无关信息去除中获得任何编码增益之前，我们将数据速率增加了 N/M 倍。
- 为了解决这个问题，开发了 MDCT。
- MDCT 是一种替代 DFT 的变换，允许块之间有 50% 的重叠，而不增加数据速率。
![image.png](https://cdn.gallery.uuanqin.top/img/20231110205908.webp)
